/*! GeoLib 02-10-2014 */
!function(){"use strict";var app=angular.module("GeoLib",[]);app.factory("MapService",function(){return{loadMap:function(data){var mapOptions={zoom:8,mapTypeId:google.maps.MapTypeId.TERRAIN},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),xmlData=$.parseXML(data),parser=new GPXParser(xmlData,map);parser.setTrackColour("#ff0000"),parser.setTrackWidth(5),parser.setMinTrackPointDelta(.001),parser.centerAndZoom(xmlData),parser.addTrackpointsToMap(),parser.addWaypointsToMap()}}}),app.factory("TrackService",function($http){return{loadTrack:function(track,callback){$http({method:"GET",url:"/geolib/resources/tracks/"+track._id}).success(function(data){callback(data,track)})},listTracks:function(callback){$http({method:"GET",url:"/geolib/resources/tracks"}).success(function(data){callback(data)})}}}),app.controller("GeoLibController",function($scope,TrackService,MapService){var activeTrack;$scope.loadTrack=function(track){TrackService.loadTrack(track,function(data,track){activeTrack=track,MapService.loadMap(data)})},$scope.listTracks=function(){TrackService.listTracks(function(tracks){$scope.tracks=tracks})},$scope.isActiveTrack=function(track){return void 0!==activeTrack&&void 0!==track&&activeTrack._id===track._id},$('[data-js-selector="fileupload"]').fileupload({dataType:"json",done:function(e,uploadedTracks){var track=uploadedTracks.result[0];$scope.loadTrack(track),$scope.tracks.push(track)}}),$scope.listTracks()})}();